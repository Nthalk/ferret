<!--
    The Ferret descriptor is a document that contains

        type:       how to work with data
        data:       what data is available and how to access it
        ui:         how to render things
        route:      how to organize an ui's with data
        security:   how to identify users and manage their access of data and routes
-->
<ferret xmlns="uri:fulcrum.net:schemas:ferret">

    <!-- These should be able to be externalizable -->
    <import resource="types.xml"/>
    <import resource="data.xml"/>
    <import resource="ui.xml"/>
    <import resource="../routes.xml"/>

    <!-- Types define underlying data types and query behavior -->
    <types>
        <type id="string"
              type="String"/>
        <type id="number"
              type="Number"/>

        <typeExtension id="indexedString"
                       extends="String"
                       search="startsWith"/>
        <typeExtension id="code"
                       extends="indexedString"/>
        <typeExtension id="description"
                       extends="String"/>
        <typeExtension id="id"
                       extends="number"/>
        <typeExtension id="currency"
                       extends="number"/>

        <referenceType id="location"
                       query="LOCATION"
                       by="ID"
                       ui="NAME"/>

        <virtualType id="gps">
            <field name="LATITUDE" type="number"/>
            <field name="LONGITUDE" type="number"/>
        </virtualType>

        <virtualType id="address">
            <field name="ADDRESS1" type="string"/>
            <field name="ADDRESS2" type="string"/>
            <field name="ADDRESS3" type="string"/>
            <field name="CITY" type="string"/>
            <field name="STATE" type="string"/>
            <field name="ZIP" type="string"/>
        </virtualType>
    </types>

    <!-- Data defines how to connect to databases, what queries there are, and metadata about their results -->
    <data>
        <jdbc
            username="ferret"
            password="ferret"
            driver="org.postgresql.Driver"
            url="jdbc:postgresql://localhost:5432/ferret"/>

        <table id="ASSET">
            <field name="ID"
                   type="id"/>
            <field name="CODE"
                   type="code"/>
            <field name="COST"
                   type="currency"/>
            <field name="LOCATIONID"
                   type="location"/>
        </table>

        <table id="LOCATION">
            <field name="ID"
                   type="Number"/>
            <field name="NAME"
                   type="string"/>
            <field name="ADDRESS"
                   type="address"/>
        </table>

        <table id="LOCATION_TYPE">
            <field name="ID"
                   type="Number"/>
            <field name="NAME"
                   type="string"/>
        </table>

        <options id="LOCATION_NAME_OPTIONS"
                 query="LOCATION"
                 value="ID"
                 label="NAME"/>

        <options id="LOCATION_TYPE_OPTIONS"
                 query="LOCATION_TYPE"
                 label="NAME"
                 value="ID"/>

    </data>

    <ui>
        <messages>
            <message id="LOCATION.NAME" value="Name"/>
        </messages>

        <ui id="home">
            <out/>
        </ui>

        <ui id="locations">

        </ui>

        <ui id="locationsCreate">
            <dataForm query="LOCATIONS"/>
        </ui>

        <ui id="locationsUpdate">
            <dataForm query="LOCATIONS"/>
        </ui>

        <ui id="carl">

        </ui>
    </ui>

    <security policy="deny">
        <authentication>
            <static>
                <user name="admin" password="admin">
                    <role name="ADMIN"/>
                </user>
            </static>
        </authentication>
        <anonymous/>
        <role name="ADMIN">
            <query name="/**" policy="read"/>
            <route path="/**" policy="read"/>
        </role>
        <role name="TECH">
            <query name="/**" policy="read"/>
            <route path="/**" policy="read"/>
        </role>
    </security>

    <route id="Home"
           ui="home">
        <notFound/>
        <controller label="Locations"
                    path="/locations"
                    query="LOCATION">
            <list/>
            <show by="ID">
                <update/>
                <delete/>
            </show>
            <create/>
        </controller>
        <controller label="Assets"
                    path="/assets"
                    query="assets">
            <list/>
            <show by="ID"/>
            <create/>
        </controller>
    </route>
</ferret>
